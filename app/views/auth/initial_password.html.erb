<div class="form-container">
  <h1>初回パスワード設定</h1>
  <p class="form-description">登録されているメールアドレスに認証コードを送信します。</p>

  <%= form_with url: auth_code_send_path, method: :post, local: true, id: "email-verification-form" do |form| %>
    <div class="form-group">
      <div class="form-row">
        <label for="employee-select" class="form-label">従業員を選択してください:</label>
        <%= form.select :employee_id,
            options_for_select(@employees.map { |emp| [emp[:display_name], emp[:id]] }, params[:employee_id]),
            { prompt: "-- 従業員を選択 --" },
            { required: true, id: "employee-select", class: "form-input" } %>
      </div>
    </div>

    <div class="form-buttons">
      <%= form.submit "認証コードを送信", class: "form-button" %>
    </div>
  <% end %>

  <div class="login-links">
    <%= link_to "ログイン画面に戻る", login_path, class: "link" %>
  </div>
</div>

<script>
  // ページ読み込み時の初期化
  document.addEventListener('DOMContentLoaded', function() {
    setupFormHandler();
  });

  function setupFormHandler() {
    const form = document.getElementById('email-verification-form');
    if (form) {
      form.addEventListener('submit', function(e) {
        const employeeSelect = document.getElementById('employee-select');

        if (!employeeSelect.value) {
          e.preventDefault();
          if (window.messageHandler) {
            window.messageHandler.show('従業員を選択してください。', 'error');
          } else {
            alert('従業員を選択してください。');
          }
          employeeSelect.focus();
          return false;
        }
      });
    }
  }
</script>
