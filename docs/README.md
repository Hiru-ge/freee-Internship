# 勤怠管理システム

## 概要

このシステムは、freee人事労務と連携した勤怠管理・シフト管理システムです。LINE BotとWebアプリケーションを組み合わせて、効率的な勤怠管理を実現します。

## クイックスタート

### 前提条件
- **freee人事労務アカウント**: 従業員・給与データ取得用
- **Ruby 3.3.0以上**: 開発環境
- **Git**: リポジトリのクローン用

### セットアップ手順
1. **リポジトリのクローン**
   ```bash
   git clone <repository-url>
   cd freee-Internship
   ```

2. **依存関係のインストール**
   ```bash
   bundle install
   ```

3. **詳細なセットアップ手順**
   - [セットアップガイド](SETUP_GUIDE.md) を参照してください
   - freee API設定、環境変数設定、データベースセットアップの詳細手順が記載されています

### オーナー権限の決定について
**重要**: オーナー権限は**シードデータ作成時**に決定され、その後は固定されます。

- 環境変数`OWNER_EMPLOYEE_ID`が設定されている場合：指定された従業員IDがオーナーとして設定されます
- 環境変数`OWNER_EMPLOYEE_ID`が設定されていない場合：すべての従業員が従業員権限として設定されます
- シードデータ作成後は、データベースの`role`カラムで権限が管理されます

## 主要機能

### Webアプリケーション
- ログイン・認証機能
- シフト管理（確認、追加、編集）
- 勤怠打刻（出勤・退勤）
- 給与管理（103万の壁ゲージ）
- シフト交代・追加依頼

### LINE Bot（Phase 15-4統合後）
- 個人チャットでの認証
- シフト確認・管理
- シフト交代依頼・承認
- シフト追加依頼・承認

## テスト

### テスト統計
- **総テストファイル数**: 34個
- **総テスト数**: 475個
- **総アサーション数**: 1,191個
- **テスト成功率**: 100%

### テスト実行
```bash
# 全テストの実行
rails test

# 特定のテストファイルの実行
rails test test/services/auth_service_test.rb

# 特定のテストの実行
rails test test/services/auth_service_test.rb -n test_ログイン処理
```

### テスト詳細
詳細なテスト情報については、[テスト概要ドキュメント](TESTING_OVERVIEW.md)を参照してください。
- シフト交代・追加・削除の管理
- 責任分離違反の修正とディレクトリ構造の整理
- 管理者機能（オーナーのみ）

### メール通知
- 認証コード送信
- シフト依頼通知
- 承認・拒否結果通知

## ドキュメント

### ユーザー向け
- [ユーザーマニュアル](USER_MANUAL.md) - システムの使い方ガイド
- [セットアップガイド](SETUP_GUIDE.md) - 初期設定手順

### 技術者向け
- [技術仕様書](TECHNICAL_SPECIFICATIONS.md) - システムの技術詳細
- [引き渡しチェックリスト](HANDOVER_CHECKLIST.md) - 引き渡し時の確認項目
- [デプロイガイド](DEPLOYMENT_GUIDE.md) - デプロイ手順
- [ローカル環境と本番環境の制限事項](LOCAL_VS_PRODUCTION_LIMITATIONS.md) - 環境別の制限事項

### その他
- [変更履歴](CHANGELOG.md) - システムの変更履歴

## トラブルシューティング

### よくある問題

1. **freee API接続エラー**
   - アクセストークンと会社IDを確認
   - freee API管理画面で新しいトークンを生成

2. **オーナー権限エラー**
   - `OWNER_EMPLOYEE_ID`が正しく設定されているか確認
   - freee人事労務で正しい従業員IDを確認

### デバッグ手順

```bash
# ログの確認
tail -f log/development.log

# 環境変数の確認
rails console
ENV["FREEE_ACCESS_TOKEN"]
ENV["OWNER_EMPLOYEE_ID"]

# データベースの確認
rails console
Employee.all
Employee.where(role: "owner")
```

## セキュリティ

- `.env`ファイルをGitにコミットしない
- 本番環境の認証情報を開発環境で使用しない
- 定期的にパスワードを変更する
- アクセスログを定期的に確認する

## サポート

問題が発生した場合は、トラブルシューティングガイドを参照してください。

---

**注意**: このシステムは完全に汎用的に設計されており、任意のfreee会社で柔軟に運用できます。従業員名やIDの制約はありません。
