# 引き渡し用チェックリスト

勤怠管理システムの引き渡し時に確認すべき項目をまとめています。このチェックリストに従って確認することで、システムが正常に動作することを保証できます。

## セットアップ完了確認

### 0. 動作確認の制限事項について

**重要**: 本システムにはローカル環境で動作する機能と本番環境（fly.io）でのみ動作する機能があります。

#### ローカル環境で動作する機能
- ✅ 基本認証・認可機能
- ✅ シフト管理機能
- ✅ 勤怠管理機能
- ✅ freee API連携
- ✅ メール通知機能（制限あり）

#### 本番環境でのみ動作する機能
- ❌ 打刻忘れアラート機能（GitHub Actions必要）
- ❌ LINE Bot連携機能（Webhook URL設定必要）

詳細は [ローカル環境と本番環境の制限事項](LOCAL_VS_PRODUCTION_LIMITATIONS.md) を参照してください。

### 1. 環境変数設定確認

#### 必須環境変数（freee関連のみ）
- [ ] `FREEE_ACCESS_TOKEN`: freee API アクセストークンが設定されている
- [ ] `FREEE_COMPANY_ID`: freee API 会社IDが設定されている
- [ ] `OWNER_EMPLOYEE_ID`: オーナー権限の従業員IDが設定されている

**注意**:
- その他の環境変数（Gmail、LINE Bot等）は既に設定済みです
- fly.ioでの動作確認について：fly.io上では、freeeアクセストークン（6時間で失効）を使用しているため、長時間の動作確認は困難です。本格的な動作確認は、独自のfreee APIトークンを取得してから行ってください
- 環境変数はGitHub以外の方法（直接的な設定）で渡すことを推奨します

### オーナー権限の決定について
**重要**: オーナー権限は**シードデータ作成時**に決定され、その後は固定されます。

- 環境変数`OWNER_EMPLOYEE_ID`が設定されている場合：指定された従業員IDがオーナーとして設定されます
- 環境変数`OWNER_EMPLOYEE_ID`が設定されていない場合：すべての従業員が従業員権限として設定されます
- シードデータ作成後は、データベースの`role`カラムで権限が管理されます

#### 環境変数値の確認
```bash
# 開発環境
rails console
puts ENV["FREEE_ACCESS_TOKEN"]
puts ENV["FREEE_COMPANY_ID"]
puts ENV["OWNER_EMPLOYEE_ID"]
```

### 2. データベース初期化確認

- [ ] データベースが作成されている
- [ ] マイグレーションが実行されている
- [ ] シードデータが生成されている
- [ ] 従業員レコードが作成されている
- [ ] オーナー権限が正しく設定されている

#### 確認コマンド
```bash
# 開発環境
rails console
Employee.count
Employee.where(role: "owner").count
Employee.where(role: "employee").count
```

### 3. 外部サービス連携確認

#### freee API連携
- [ ] freee APIから従業員データが取得できる
- [ ] 従業員名が正しく表示される
- [ ] メールアドレスが正しく取得される

**注意**: その他の外部サービス（Gmail、LINE Bot等）は既に設定済みです。

## 動作確認項目

### 1. ローカル環境での確認（基本機能）

#### 認証機能
- [ ] メールアドレス認証が動作する
- [ ] 認証コードが正しく送信される
- [ ] 認証コード入力でログインできる
- [ ] セッション管理が正常に動作する

#### シフト管理機能
- [ ] シフト表が正しく表示される
- [ ] 週単位でのシフト表示が動作する
- [ ] シフトの追加・編集ができる（オーナーのみ）
- [ ] シフト交代依頼ができる
- [ ] シフト交代承認ができる

#### 勤怠管理機能
- [ ] 出勤打刻ができる
- [ ] 退勤打刻ができる
- [ ] 勤怠履歴が正しく表示される
- [ ] 勤怠統計が正しく計算される

#### freee API連携
- [ ] 従業員情報が正しく取得される
- [ ] 給与情報が正しく表示される
- [ ] 打刻データが正しく送信される

#### メール通知機能
- [ ] シフト交代リクエスト時のメール通知
- [ ] シフト追加リクエスト時のメール通知

#### 給与管理機能
- [ ] 103万の壁ゲージが表示される
- [ ] 給与計算が正しく行われる
- [ ] 時間帯別時給が適用される

### 2. 本番環境での確認（外部サービス連携）

#### 打刻忘れアラート機能
- [ ] GitHub Actionsが正常に実行される
- [ ] 打刻忘れアラートのメール通知が送信される
- [ ] 手動実行でアラート機能が動作する

**確認方法**:
```bash
# 本番環境で手動実行
fly ssh console -a freee-internship -C "bundle exec rails clock_reminder:check_all"

# GitHub Actionsで手動実行
# GitHubのActionsタブから「Clock Reminder Check」を手動実行
```

#### LINE Bot機能（本番環境でのみ動作）

**注意**: LINE Botは本番環境でのみ動作します。ローカル環境ではテストできません。

##### 認証機能
- [ ] 個人チャットで「認証」コマンドが動作する
- [ ] 従業員名入力ができる
- [ ] 認証コードがメールで送信される
- [ ] 認証コード入力で認証が完了する

##### シフト管理機能
- [ ] 「シフト確認」コマンドが動作する
- [ ] 「全員シフト確認」コマンドが動作する
- [ ] 「交代依頼」コマンドが動作する
- [ ] 「依頼確認」コマンドが動作する
- [ ] 「欠勤申請」コマンドが動作する

##### 管理者機能（オーナーのみ）
- [ ] 「追加依頼」コマンドが動作する
- [ ] シフト追加依頼の承認・拒否ができる

### 3. メール通知機能

#### 認証関連
- [ ] 認証コードメールが送信される
- [ ] パスワードリセットメールが送信される

#### シフト管理関連
- [ ] シフト交代依頼メールが送信される
- [ ] シフト追加依頼メールが送信される
- [ ] 欠勤申請メールが送信される
- [ ] 承認・拒否結果メールが送信される

### 4. 権限管理機能

#### オーナー権限
- [ ] オーナーとしてログインできる
- [ ] 全従業員のシフトを確認できる
- [ ] シフト追加依頼ができる
- [ ] 全従業員の給与情報を確認できる

#### 従業員権限
- [ ] 従業員としてログインできる
- [ ] 個人のシフトのみ確認できる
- [ ] シフト交代依頼ができる
- [ ] 個人の給与情報のみ確認できる

## パフォーマンス確認

### 1. レスポンス時間
- [ ] ログイン処理: 3秒以内
- [ ] シフト表表示: 2秒以内
- [ ] LINE Bot応答: 1秒以内
- [ ] メール送信: 5秒以内

### 2. 同時接続
- [ ] 複数ユーザーでの同時アクセスが可能
- [ ] データの整合性が保たれる
- [ ] エラーが発生しない

### 3. データ整合性
- [ ] freee APIとWebアプリのデータが一致する
- [ ] シフト変更が正しく反映される
- [ ] 勤怠データが正しく記録される

## セキュリティ確認

### 1. 認証・認可
- [ ] 未認証ユーザーはアクセスできない
- [ ] 権限のない機能は実行できない
- [ ] セッション期限切れが正常に動作する

### 2. データ保護
- [ ] 機密情報がログに出力されない
- [ ] パスワードが適切にハッシュ化されている
- [ ] 外部からの不正アクセスが防げる

### 3. 入力値検証
- [ ] 不正な入力値が適切に処理される
- [ ] SQLインジェクション攻撃が防げる
- [ ] XSS攻撃が防げる

## 引き渡し確認項目

### 1. ドキュメント整備確認
- [ ] 簡素化セットアップガイドが完成している
- [ ] トラブルシューティングガイドが完成している
- [ ] API仕様書が最新になっている
- [ ] システム仕様書が最新になっている

### 2. 動作確認完了確認
- [ ] 全機能の動作確認が完了している
- [ ] エラーが発生していない
- [ ] パフォーマンスが要件を満たしている
- [ ] セキュリティ要件を満たしている

### 3. 引き渡し先への説明完了確認
- [ ] システム概要の説明が完了している
- [ ] 主要機能の使い方の説明が完了している
- [ ] 管理方法の説明が完了している
- [ ] トラブル時の対応方法の説明が完了している

## 引き渡し後のサポート

### 1. 初期サポート期間
- [ ] 引き渡し後1週間のサポート体制
- [ ] 緊急時の連絡先の提供
- [ ] 問題発生時の対応手順の説明

### 2. ドキュメント提供
- [ ] システム管理マニュアル
- [ ] ユーザー操作マニュアル
- [ ] トラブルシューティングガイド
- [ ] 技術仕様書

### 3. 今後の拡張予定
- [ ] 機能拡張の可能性の説明
- [ ] 技術的な制約の説明
- [ ] 運用上の注意点の説明

## チェックリスト完了確認

### 最終確認項目
- [ ] 全てのセットアップ項目が完了している
- [ ] 全ての動作確認項目が完了している
- [ ] 全ての引き渡し確認項目が完了している
- [ ] 引き渡し先がシステムを正常に運用できる状態になっている

### 引き渡し完了
- [ ] 引き渡し先への説明が完了している
- [ ] 必要なドキュメントが提供されている
- [ ] サポート体制が整備されている
- [ ] 引き渡しが正式に完了している

---

## 注意事項

1. **このチェックリストは必須項目です**
   - 全ての項目を確認してから引き渡しを行ってください
   - 未完了の項目がある場合は、完了してから引き渡しを行ってください

2. **問題が発生した場合**
   - トラブルシューティングガイドを参照してください
   - 解決できない場合は、技術サポートに連絡してください

3. **引き渡し後の変更**
   - システムの変更は慎重に行ってください
   - 重要な変更は事前にテストを行ってください

このチェックリストに従って確認を行うことで、勤怠管理システムの正常な引き渡しを保証できます。
