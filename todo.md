# 勤怠管理システム - タスク管理

## 概要
勤怠管理チェックアプリのタスク管理一覧です。
現在の基本機能は実装完了しており、以下の項目は今後の改善・拡張として管理しています。

## 🔴 緊急（Rails移行・既存機能完全移行）

### 移行方針
- **完全再現**: GAS時代の画面と全く同じデザイン・動作
- **機能単位**: 各機能を完全に移行してから次へ
- **段階的コミット**: 各機能完了時にコミット
- **コピペ推奨**: 既存のHTML/CSS/JSを最大限活用

### Rails移行 Phase 1: 基盤構築（最優先）
- [x] Railsアプリケーションの作成
  - 新しいRails 8.0.2アプリケーションの作成
  - 必要なgemの設定（line-bot-api, dotenv-rails等）
  - 基本的なディレクトリ構造の構築
  - 見積時間: 30分

- [x] 基本的なWebhookエンドポイントの実装
  - WebhookControllerの作成
  - LINE Bot SDKの設定
  - 基本的なメッセージ受信・応答機能
  - 見積時間: 30分

### Rails移行 Phase 2: 既存機能完全移行（最重要）

#### Phase 2-1: 認証システム移行（✅ 完了）
- [x] データベース設計・実装
  - employeesテーブル（認証情報のみ）
  - verification_codesテーブル（認証コード管理）
  - マイグレーション実行
  - 見積時間: 30分

- [x] 認証システムの完全移行
  - ログイン画面（view_login.html → app/views/auth/login.html.erb）
  - 初回パスワード設定（view_initial_password.html → app/views/auth/initial_password.html.erb）
  - パスワード変更（view_password_change.html → app/views/auth/password_change.html.erb）
  - パスワード忘れ（view_forgot_password.html → app/views/auth/forgot_password.html.erb）
  - 見積時間: 2時間

- [x] freee API連携の実装
  - FreeeApiService（code-api.js → app/services/freee_api_service.rb）
  - 認証サービス（code-auth.js → app/services/auth_service.rb）
  - 従業員情報の動的取得
  - 実データでのDB再構築
  - 見積時間: 1.5時間

- [x] メール送信機能の実装
  - AuthMailer（Gmail SMTP連携）
  - 認証コード送信機能
  - パスワードリセット機能
  - 見積時間: 1時間

- [x] 環境変数への移行
  - 機密情報の.envファイル分離
  - セキュリティ向上
  - 見積時間: 30分

- [x] 認証機能のテスト・コミット
  - ログイン機能の動作確認
  - パスワード変更機能の動作確認
  - freee API連携の動作確認
  - セッション管理の動作確認
  - コミット: "feat: 認証システムの完全移行"
  - 見積時間: 30分

#### Phase 2-2: マイページ機能移行（✅ 完了）
- [x] マイページ機能の完全移行
  - マイページトップ（view_my_page.html → app/views/dashboard/index.html.erb）
  - 打刻機能（code-clock.js → app/services/clock_service.rb）
  - 勤怠履歴表示
  - 月次ナビゲーション
  - 見積時間: 2時間

- [x] マイページ機能のテスト・コミット
  - 打刻機能の動作確認
  - 勤怠履歴の表示確認
  - コミット: "feat: マイページ・打刻機能の完全移行"
  - 見積時間: 30分

#### Phase 2-3: シフト管理機能移行（✅ 完了）
- [x] シフト管理機能の完全移行
  - シフトページ（view_shift_page.html → app/views/shifts/index.html.erb）
  - シフト表示・確認機能
  - 月次ナビゲーション
  - 見積時間: 1.5時間

- [x] シフト情報のDB取り込み
  - Shiftモデルの作成
  - マイグレーション実行
  - GASテストデータの移植（81件）
  - 見積時間: 1時間

- [x] freee API連携によるシフトデータ取得
  - FreeeApiService#get_employees実装
  - ShiftsController#data実装
  - 従業員情報とシフトデータの統合
  - 見積時間: 1時間

- [x] 103万の壁ゲージのHTML枠作成
  - オーナー向け給与ゲージセクション
  - 従業員向け個人ゲージセクション
  - 実装予定表示
  - 見積時間: 0.5時間

- [x] シフト管理機能のテスト・コミット
  - シフト表示の動作確認
  - ナビゲーションの動作確認
  - GAS版との整合性確認
  - コミット: "feat: シフト管理機能の完全移行"
  - 見積時間: 30分

#### Phase 2-4: シフト交代機能移行
- [ ] シフト交代機能の完全移行
  - シフト交代リクエスト（view_shift_request_form.html → app/views/shifts/request.html.erb）
  - シフト交代承認（view_shift_approval.html → app/views/shifts/approval.html.erb）
  - シフト追加依頼（view_shift_add_form.html → app/views/shifts/add.html.erb）
  - 見積時間: 2.5時間

- [ ] シフト交代機能のテスト・コミット
  - リクエスト送信の動作確認
  - 承認・否認の動作確認
  - コミット: "feat: シフト交代機能の完全移行"
  - 見積時間: 30分

#### Phase 2-5: 給与管理機能移行
- [ ] 給与管理機能の完全移行
  - 103万の壁ゲージ（code-wage.js → app/services/wage_service.rb）
  - 給与計算・表示機能
  - 時間帯別時給システム
  - 見積時間: 2時間

- [ ] 給与管理機能のテスト・コミット
  - 給与計算の動作確認
  - ゲージ表示の動作確認
  - コミット: "feat: 給与管理機能の完全移行"
  - 見積時間: 30分

### Rails移行 Phase 3: 統合・最適化

#### Phase 3-1: UI・UX統一
- [ ] CSS・デザイン統一
  - css.html → app/assets/stylesheets/application.css
  - 全画面のデザイン統一
  - レスポンシブ対応
  - 見積時間: 1時間

- [ ] エラーハンドリング統一
  - 統一されたエラー表示システム
  - エラーメッセージの標準化
  - 見積時間: 1時間

- [ ] ローディング状態改善
  - プログレスバー、詳細なローディング表示
  - ユーザビリティ向上
  - 見積時間: 1時間

#### Phase 3-2: バックグラウンド処理
- [ ] 自動通知機能の実装
  - 打刻リマインダーの送信
  - 103万の壁アラート通知
  - シフト変更通知
  - 見積時間: 2時間

- [ ] データ同期機能
  - freee APIとの定期同期
  - キャッシュの自動更新
  - 見積時間: 1時間

### Rails移行 Phase 4: デプロイ・本番環境構築
- [ ] Herokuへのデプロイ
  - Herokuアプリケーションの作成
  - 環境変数の設定
  - デプロイの実行
  - LINE Webhook URLの設定・検証
  - 見積時間: 1時間

- [ ] 本番環境での動作確認
  - 全機能の動作確認
  - パフォーマンステスト
  - エラーハンドリングの確認
  - 見積時間: 1時間

### LINE連携 Phase 2: 高度な機能（Rails移行完了後）
- [ ] LINE Bot機能の実装
  - 個人LINEでの勤怠状況確認
  - 勤怠データの表示
  - 見積時間: 4時間

- [ ] LINE連携の高度な機能
  - 103万の壁ゲージの状況表示
  - 給与情報の確認
  - 見積時間: 3時間

### LINE連携 Phase 3: 拡張機能（Rails移行完了後）
- [ ] 統計・レポート機能の実装
  - 勤怠統計の表示
  - 給与レポートの生成
  - 見積時間: 5時間

- [ ] カスタマイズ機能の実装
  - 通知設定のカスタマイズ
  - 表示設定の調整
  - 見積時間: 4時間

## 🟡 重要（セキュリティ・安定性）

### セッション有効期限の実装
- [ ] セッションタイムアウト機能の追加
  - 一定時間後の自動ログアウト機能
  - セキュリティ向上、不正アクセス防止
  - 見積時間: 4時間

### 入力値のサーバーサイドバリデーション
- [ ] 各API関数での入力値検証強化
  - サーバーサイドでの厳格な入力値検証
  - データ整合性確保、セキュリティ向上
  - 見積時間: 6時間

### 権限チェックの強化
- [ ] 全API関数での権限チェック追加
  - 各API呼び出しでの権限検証
  - 不正な権限昇格の防止
  - 見積時間: 3時間

## 🟢 通常（ユーザビリティ）

### エラーメッセージの統一
- [ ] 統一されたエラー表示システムの実装
  - `alert()`と`showMessage()`の統一
  - UX向上、一貫性の確保
  - 見積時間: 2時間

### ローディング状態の改善
- [ ] プログレスバー、詳細なローディング表示の実装
  - より詳細な進捗表示
  - ユーザビリティ向上
  - 見積時間: 3時間

### データの整合性チェック
- [ ] データ整合性チェック機能の実装
  - 重複データ、不正データの検出
  - データ品質向上
  - 見積時間: 4時間

## 🟢 通常（機能拡張）

### ログ機能の実装
- [ ] ログ記録システムの実装
  - 操作ログ、エラーログの記録
  - デバッグ支援、監査証跡
  - 見積時間: 5時間

### バックアップ・復旧機能
- [ ] 自動バックアップ機能の実装
  - データのバックアップ機能
  - データ保護、災害復旧
  - 見積時間: 6時間

## 完了済み機能 ✅

### Rails移行準備・ドキュメント整備
- [x] TODOファイルの見直しと既存機能移行の優先順位調整
- [x] データベーススキーマ設計書の作成（既存機能完全移行のためのPostgreSQLスキーマ設計）
- [x] 残りのドキュメントをRails用に書き換え（仕様書、画面設計、LINE連携仕様、完全ガイドの作成）
- [x] 不要になったドキュメントの削除（clasp_setup.md、rails-migration-plan.md、rails-migration-technical-spec.md、rails-setup-guide.md）
- [x] 移行手順の詳細化と機能ごとの集中移行計画策定

### GAS時代の実装済み機能（Rails移行対象）
以下の機能はGAS時代に実装済みで、Rails移行の対象となります：

#### 認証・セキュリティ機能
- 認証設定画面（パスワード変更画面）
- パスワードハッシュ化機能
- ログイン認証機能
- セッション管理機能（基本版）
- 権限管理機能
- パスワードポリシー
- ログアウト機能

#### UI・画面機能
- マイページトップ画面
- シフトページ画面
- ログイン画面
- 初回パスワード設定画面
- パスワード変更画面
- シフト交代リクエスト画面
- シフト交代承認画面
- シフト追加依頼画面

#### コア機能
- 打刻機能（出勤・退勤）
- 勤怠履歴表示
- シフト表示・確認
- シフト交代機能
- 103万の壁ゲージ機能
- 給与計算・表示機能

#### バックグラウンド機能
- 打刻忘れアラート機能
- 退勤打刻リマインダー機能

## タスク管理情報

### 実装優先順位（機能ごとの集中移行）

#### 🔴 最優先: 認証システム移行
1. **Phase 2-1: 認証システム移行**
   - データベース設計・実装
   - 認証システムの完全移行
   - freee API連携の実装
   - 認証機能のテスト・コミット

#### 🟡 重要: コア機能移行
2. **Phase 2-2: マイページ機能移行**
   - マイページ機能の完全移行
   - マイページ機能のテスト・コミット

3. **Phase 2-3: シフト管理機能移行**
   - シフト管理機能の完全移行
   - シフト管理機能のテスト・コミット

#### 🟡 重要: 高度な機能移行
4. **Phase 2-4: シフト交代機能移行**
   - シフト交代機能の完全移行
   - シフト交代機能のテスト・コミット

5. **Phase 2-5: 給与管理機能移行**
   - 給与管理機能の完全移行
   - 給与管理機能のテスト・コミット

#### 🟢 通常: 統合・最適化
6. **Phase 3-1: UI・UX統一**
   - CSS・デザイン統一
   - エラーハンドリング統一
   - ローディング状態改善

7. **Phase 3-2: バックグラウンド処理**
   - 自動通知機能の実装
   - データ同期機能

#### 🟢 通常: デプロイ・本番環境
8. **Phase 4: デプロイ・本番環境構築**
   - Herokuへのデプロイ
   - 本番環境での動作確認

#### 🟢 通常: セキュリティ・安定性
9. セッション有効期限の実装
10. 入力値のサーバーサイドバリデーション
11. 権限チェックの強化
12. データの整合性チェック
13. ログ機能の実装
14. バックアップ・復旧機能

#### 🟢 通常: LINE連携（Rails移行完了後）
15. LINE Bot機能の実装
16. LINE連携の高度な機能
17. 統計・レポート機能の実装
18. カスタマイズ機能の実装

### 進捗状況
- **完了済み**: 基本機能、認証機能、UI機能、ドキュメント整備、Rails移行準備、Rails移行 Phase 1完了、Phase 2-1 認証システム移行完了、Phase 2-2 マイページ機能移行完了、Phase 2-3 シフト管理機能移行完了
- **最優先**: Phase 2-4 シフト交代機能移行（3時間）
- **次優先**: Phase 2-5 給与管理機能移行（2時間）
- **総見積時間**: 17時間（Rails移行: 17時間、その他: 33時間）

### 最新の完了状況（2025年9月9日）
- **Phase 2-2: マイページ機能移行** ✅ **完了**
  - マイページトップ画面の完全移行
  - 打刻機能（出勤・退勤）の実装
  - 勤怠履歴表示機能の実装
  - 月次ナビゲーション機能の実装
  - freee API連携の完全統合
  - API接続エラーの解決

- **Phase 2-3: シフト管理機能移行** ✅ **完了**
  - シフトページの完全移行（view_shift_page.html → shifts/index.html.erb）
  - シフト表示・確認機能の実装
  - 月次ナビゲーション機能の実装
  - freee API連携によるシフトデータ取得
  - シフト情報のDB取り込み（81件のシフトデータ）
  - 103万の壁ゲージのHTML枠作成
  - GAS版との整合性確保

### 移行手順の詳細

#### 各機能の移行手順
1. **GASファイルの確認**: `backup/gas-files/src/` から対象ファイルを特定
2. **Railsファイルの作成**: 対応するRailsファイルを作成
3. **完全再現**: GAS時代の画面と全く同じデザイン・動作を実現
4. **テスト**: 機能の動作確認を徹底
5. **コミット**: 機能完了時にコミット

#### ファイルマッピング
- `view_login.html` → `app/views/auth/login.html.erb`
- `view_my_page.html` → `app/views/dashboard/index.html.erb`
- `view_shift_page.html` → `app/views/shifts/index.html.erb`
- `code-auth.js` → `app/services/auth_service.rb`
- `code-api.js` → `app/services/freee_api_service.rb`
- `css.html` → `app/assets/stylesheets/application.css`

### 関連仕様
- 仕様書: `docs/requirement.md`（Rails版）
- 画面設計: `docs/screen-design.md`（Rails版）
- LINE連携仕様: `docs/line-integration.md`（Rails版）
- データベーススキーマ設計: `docs/database-schema-design.md`
- Rails移行完全ガイド: `docs/rails-migration-complete-guide.md`
- 103万ゲージ実装状況: `docs/103万ゲージ実装状況.md`

### 更新履歴
- 2024年: TODOファイルの構造化とタスク管理形式への変更
- 基本機能の実装完了
- ドキュメント整備完了
- Rails移行計画の策定（GASの制約により方針転換）
- Rails移行準備完了（データベース設計、ドキュメント整備、不要ファイル削除）
